---
title: 升级至7.0
description: 将应用中Capacitor从v6升级到v7的指南
slug: /updating/7-0
---

# 从Capacitor 6升级到Capacitor 7

本指南将为您介绍如何将项目升级至当前Capacitor 7版本，同时列出官方插件的重大变更事项。

## Capacitor配置文件的重大变更

`bundledWebRuntime`配置选项已被移除。若原先设置为`false`可直接删除该配置；若设为`true`，则需使用打包工具将`@capacitor/core`代码打包至应用中。

`cordova.staticPlugins`配置选项已被移除。如需使用静态Cordova插件，现应改用带有`use-framework`属性的`podspec`标签，而非`framework`标签（cordova-ios 7+已不再支持后者）。

## NodeJS 20+环境要求

Node 18已于2023年10月18日终止主流支持。Capacitor 7要求NodeJS 20或更高版本（推荐使用最新的LTS版本）。

## 遥测功能改为默认开启

此变更仅影响新用户——若您曾执行过任何Capacitor命令，系统已保存相关偏好设置。同时，遥测功能不会在非交互环境（如CI服务器）中运行，确保这些场景下不会收集数据。
可通过`npx cap telemetry off`命令关闭该功能。

## 使用CLI进行迁移

在项目中安装最新版Capacitor CLI：

```sh
npm i -D @capacitor/cli@latest
```

安装完成后，执行以下命令让CLI自动处理迁移：

```sh
npx cap migrate
```

如遇迁移步骤无法完成，终端输出将提供额外信息。下方列出了手动迁移的具体步骤。

## iOS平台升级指南

以下说明如何将Capacitor 6 iOS项目升级至Capacitor 7。

### 升级Xcode

Capacitor 7要求Xcode 16.0+版本。

### 提高iOS部署目标

在Xcode项目中：选择项目编辑器中的**Project**，打开**Build Settings**选项卡。在**Deployment**部分，将**iOS Deployment Target**改为**iOS 14.0**。对所有的应用**Targets**重复相同步骤。

接着，修改`ios/App/Podfile`中的iOS版本为14.0：

```ruby
platform :ios, '14.0'
```

## Android平台升级指南

以下说明如何将Capacitor 6 Android项目升级至Capacitor 7。

### 升级Android Studio

Capacitor 7需要Android Studio Ladybug | 2024.2.1或更新版本及Java JDK 21。Android Studio Ladybug自带Java 21，无需额外下载！

升级后，Android Studio可协助处理gradle相关更新及构建文件中的包迁移。首先运行`工具 -> AGP升级助手`。

![AGP升级助手](/img/v6/docs/android/agp-upgrade-assistant.png)

### 更新Android项目变量

在`variables.gradle`文件中更新以下最低要求值：

```groovy
minSdkVersion = 23
compileSdkVersion = 35
targetSdkVersion = 35
androidxActivityVersion = '1.9.2'
androidxAppCompatVersion = '1.7.0'
androidxCoordinatorLayoutVersion = '1.2.0'
androidxCoreVersion = '1.15.0'
androidxFragmentVersion = '1.8.4'
coreSplashScreenVersion = '1.0.1'
androidxWebkitVersion = '1.12.1'
junitVersion = '4.13.2'
androidxJunitVersion = '1.2.1'
androidxEspressoCoreVersion = '3.6.1'
cordovaAndroidVersion = '10.1.1'
```

### 更新Google服务插件

```diff
# build.gradle

    dependencies {
        classpath 'com.android.tools.build:gradle:8.2.1'
-       classpath 'com.google.gms:google-services:4.4.0'
+       classpath 'com.google.gms:google-services:4.4.2'
```

### 升级Gradle插件至8.7.2

```diff
# build.gradle

    dependencies {
-       classpath 'com.android.tools.build:gradle:8.2.1'
+       classpath 'com.android.tools.build:gradle:8.7.2'
```

### 更新Gradle Wrapper至8.11.1

```diff
# gradle-wrapper.properties

distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
- distributionUrl=https\://services.gradle.org/distributions/gradle-82.1-all.zip
+ distributionUrl=https\://services.gradle.org/distributions/gradle-8.11.1-all.zip
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
```

### 更新Kotlin版本

若项目使用Kotlin，请将`kotlin_version`变量更新为`'1.9.25'`。

### 在configChanges中添加navigation

此为非强制变更，用于防止部分设备在使用蓝牙键盘时导致应用重启。在`AndroidManifest.xml`中的app`activity`内为`configChanges`添加`navigation`：

```diff
- android:configChanges="orientation|keyboardHidden|keyboard|screenSize|locale|smallestScreenSize|screenLayout|uiMode"
+ android:configChanges="orientation|keyboardHidden|keyboard|screenSize|locale|smallestScreenSize|screenLayout|uiMode|navigation"
```

## 插件更新

所有插件均已升级至7.0.0版本，请确保更新至最新版本。

以下插件功能已修改或移除，请相应调整代码：

### Action Sheet

- `androidxMaterialVersion`变量更新为`1.12.0`

### App

- 已弃用类型`AppRestoredResult`移除，改用`RestoredListenerEvent`
- 已弃用类型`AppUrlOpen`移除，改用`URLOpenListenerEvent`

### Browser

- `androidxBrowserVersion`变量更新为`1.8.0`

### Camera

- `androidxExifInterfaceVersion`变量更新为`1.3.7`
- `androidxMaterialVersion`变量更新为`1.12.0`

### Device

- `getInfo()`不再返回`diskFree`、`diskTotal`、`realDiskFree`和`realDiskTotal`，可移除该插件的`PrivacyInfo.xcprivacy`条目
- 已弃用类型`DeviceBatteryInfo`移除，改用`BatteryInfo`
- 已弃用类型`DeviceLanguageCodeResult`移除，改用`GetLanguageCodeResult`

### Geolocation

- `playServicesLocationVersion`变量更新为`21.3.0`

### Haptics

- 已弃用类型`HapticsImpactOptions`移除，改用`ImpactOptions`
- 已弃用类型`HapticsNotificationOptions`移除，改用`NotificationOptions`
- 已弃用类型`HapticsNotificationType`移除，改用`NotificationType`
- 已弃用类型`HapticsImpactStyle`移除，改用`ImpactStyle`

### Push Notifications

- `firebaseMessagingVersion`变量更新为`24.1.0`

### Share

- `androidxCoreVersion`变量更新为`1.15.0`

### Splash Screen

- 已弃用类型`SplashScreenShowOptions`移除，改用`ShowOptions`
- 已弃用类型`SplashScreenHideOptions`移除，改用`HideOptions`

### Status Bar

- `setOverlaysWebView()`和`setBackgroundColor()`现支持iOS平台
- `androidxCoreVersion`变量更新为`1.15.0`