---
title: å‡çº§è‡³ 3.0 ç‰ˆæœ¬
description: å°†åº”ç”¨ä¸­çš„ Capacitor ä» v2 å‡çº§è‡³ v3 çš„æŒ‡å—
slug: /updating/3-0
---

# åœ¨åº”ç”¨ä¸­å‡çº§ Capacitor è‡³ 3.0

Capacitor 3 ä¸ºç”Ÿæ€ç³»ç»Ÿå¸¦æ¥äº†å…³é”®æ›´æ–°å’Œæ¿€åŠ¨äººå¿ƒçš„æ–°ç‰¹æ€§ã€‚

[é˜…è¯» Capacitor 3.0 å‘å¸ƒå…¬å‘Š &#8250;](https://ionicframework.com/blog/announcing-capacitor-3-0/)

> åœ¨å°†åº”ç”¨å‡çº§è‡³ Capacitor 3 åï¼Œæ‚¨æ˜¯å¦æ„¿æ„åœ¨[æ­¤è®¨è®º](https://github.com/ionic-team/capacitor/discussions/3994)ä¸­åˆ†äº«æ‚¨çš„åé¦ˆï¼Ÿæˆ‘ä»¬éå¸¸ä¹æ„å¬å–æ‚¨çš„æ„è§ï¼ğŸ’–

å¦‚æœæ‚¨æ˜¯æ’ä»¶ä½œè€…ï¼Œå¸Œæœ›å°†æ‚¨çš„æ’ä»¶å‡çº§è‡³æ›´æ–°çš„ Capacitor ç‰ˆæœ¬ï¼Œè¯·å‚é˜…[Capacitor æ’ä»¶å‡çº§æŒ‡å—](/main/updating/plugins/3-0.md)ã€‚

## NodeJS 12+

Node 8 å·²ç»“æŸç”Ÿå‘½å‘¨æœŸæ”¯æŒã€‚Node 10 å°†äº 2021 å¹´ 4 æœˆ 30 æ—¥ç»“æŸç”Ÿå‘½å‘¨æœŸæ”¯æŒã€‚Capacitor 3 è¦æ±‚ NodeJS 12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ï¼ˆæ¨èä½¿ç”¨æœ€æ–°çš„ LTS ç‰ˆæœ¬ã€‚ï¼‰

## Ionic CLI

å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ Ionic CLIï¼Œå®˜æ–¹å¯¹ Capacitor 3 çš„æ”¯æŒä»ç‰ˆæœ¬ 6.16.0 å¼€å§‹ã€‚æˆ‘ä»¬å»ºè®®é€šè¿‡ `npm install -g @ionic/cli` å‡çº§è‡³æœ€æ–°ç‰ˆæœ¬ã€‚

## æ›´æ–° Capacitor CLI å’Œæ ¸å¿ƒåº“

```bash
npm install @capacitor/cli@latest-3 @capacitor/core@latest-3
```

## ES2017+

Capacitor 3 ç°åœ¨æ„å»ºé¢å‘ ES2017 ç¯å¢ƒï¼Œè€Œé ES5ã€‚[æ’ä»¶æ¨¡æ¿ä¹Ÿå·²æ›´æ–°](https://github.com/ionic-team/capacitor/pull/3427/files#diff-b22b3d0cbb7d8f6fdfe1f6f1d9e84b7d)ä»¥æ”¯æŒ ES2017ï¼Œé¼“åŠ±ç¬¬ä¸‰æ–¹æ’ä»¶æ›´æ–°å…¶ç›®æ ‡ç¯å¢ƒã€‚

æ­¤æ›´æ”¹ä¸åº”å½±å“æ‚¨çš„åº”ç”¨ï¼Œé™¤éæ‚¨éœ€è¦æ”¯æŒ IE11ï¼Œè€Œ Capacitor å®˜æ–¹å¹¶ä¸æ”¯æŒ IE11ã€‚

## TypeScript 3.8+

Capacitor 3 ä½¿ç”¨äº†æ–°çš„ TypeScript è¯­æ³•ï¼Œä»…å¯åœ¨ TS 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚

## Capacitor é…ç½®å˜æ›´

å¦‚æœæ‚¨å·²å®‰è£… TypeScript 3.8+ï¼Œæ‚¨å¯ä»¥å°† `capacitor.config.json` è¿ç§»ä¸ºç±»å‹åŒ–çš„ TypeScript é…ç½®æ–‡ä»¶ï¼Œå‘½åä¸º `capacitor.config.ts`ã€‚æ‚¨å¯ä»¥ç»§ç»­ä½¿ç”¨ `.json` æ–‡ä»¶ï¼Œä½† TypeScript é…ç½®æ–‡ä»¶å¯èƒ½ä¸ºæ‚¨çš„å›¢é˜Ÿæä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚ä»¥ä¸‹æ˜¯åœ¨ [Capacitor æµ‹è¯•åº”ç”¨](https://github.com/ionic-team/capacitor-testapp)ä¸­ä½¿ç”¨çš„ `capacitor.config.ts` æ–‡ä»¶ç¤ºä¾‹ã€‚

```typescript
/// <reference types="@capacitor/local-notifications" />
/// <reference types="@capacitor/push-notifications" />
/// <reference types="@capacitor/splash-screen" />

import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.capacitorjs.app.testapp',
  appName: 'capacitor-testapp',
  webDir: 'build',
  plugins: {
    SplashScreen: {
      launchAutoHide: false,
    },
    LocalNotifications: {
      smallIcon: 'ic_stat_icon_config_sample',
      iconColor: '#CE0B7C',
    },
    PushNotifications: {
      presentationOptions: ['alert', 'sound'],
    },
  },
};

export default config;
```

## å®˜æ–¹æ’ä»¶

æ‰€æœ‰æ’ä»¶å·²ä» Capacitor æ ¸å¿ƒåº“ä¸­ç§»é™¤ï¼Œå¹¶æ”¾ç½®åˆ°å®ƒä»¬å„è‡ªçš„ npm åŒ…ä¸­ã€‚è¿™æ ·åšæœ‰å‡ ä¸ªåŸå› ï¼ˆå‚è§ [#3227](https://github.com/ionic-team/capacitor/issues/3227)ï¼‰ï¼Œæ ¸å¿ƒå›¢é˜Ÿç¡®ä¿¡è¿™æ˜¯æ­£ç¡®çš„æ–¹å‘ã€‚æ‚¨å¯ä»¥åƒè¿™æ ·å¯¼å…¥æ ¸å¿ƒæ’ä»¶ã€‚

```typescript
import { Camera } from '@capacitor/camera';
```

### ç§»é™¤åå°ä»»åŠ¡ã€æƒé™å’Œç…§ç‰‡æ’ä»¶

- **åå°ä»»åŠ¡**ï¼šæ­¤æ’ä»¶ä¼¼ä¹å¾ˆå°‘ä½¿ç”¨ï¼Œä¸”å·¥ä½œæ–¹å¼ä¸å¤§å¤šæ•°å¼€å‘è€…çš„é¢„æœŸä¸å¤ªä¸€è‡´ã€‚æ ¸å¿ƒå›¢é˜Ÿå°†åœ¨æœªæ¥é‡æ–°å®¡è§†åå°åŠŸèƒ½ã€‚è®¢é˜… [#3032](https://github.com/ionic-team/capacitor/issues/3032) ä»¥è·å–æ›´æ–°ã€‚
- **æƒé™**ï¼šæ ¸å¿ƒå›¢é˜Ÿå·²å®ç°äº†æ­¤é›†ä¸­å¼æ–¹æ³•çš„æ›¿ä»£æ–¹æ¡ˆï¼Œç¤¾åŒºæ’ä»¶ä¹Ÿå¯èƒ½é‡‡ç”¨ï¼ˆå‚è§[æ–°çš„æƒé™ API](/plugins/creating-plugins/web-guide.md#permissions)ï¼‰ã€‚
- **ç…§ç‰‡**ï¼šæ­¤æœªæ–‡æ¡£åŒ–çš„ä»…é™ iOS çš„æ’ä»¶å·²è¢«ç§»é™¤ã€‚è¯·ä½¿ç”¨ [`@capacitor-community/media`](https://github.com/capacitor-community/media)ã€‚

### æ‹†åˆ†è¾…åŠ©åŠŸèƒ½ã€åº”ç”¨å’Œæ¨¡æ€æ¡†æ’ä»¶

- **è¾…åŠ©åŠŸèƒ½**
  - VoiceOver å’Œ TalkBack åŠŸèƒ½ç§»è‡³ [**å±å¹•é˜…è¯»å™¨**](/apis/screen-reader.md)
- **åº”ç”¨**
  - ä¸åº”ç”¨ç›¸å…³çš„ä¿¡æ¯å’ŒåŠŸèƒ½ä¿ç•™åœ¨ [**åº”ç”¨**](/apis/app.md) ä¸­
  - åº”ç”¨ URL å¤„ç†ï¼ˆ`openUrl()` å’Œ `canOpenUrl()`ï¼‰ç§»è‡³ [**åº”ç”¨å¯åŠ¨å™¨**](/apis/app-launcher.md)
- **æ¨¡æ€æ¡†**
  - æ“ä½œè¡¨åŠŸèƒ½ï¼ˆ`showActions()`ï¼‰ç§»è‡³ [**æ“ä½œè¡¨**](/apis/action-sheet.md)
  - å¯¹è¯æ¡†çª—å£åŠŸèƒ½ï¼ˆ`alert()`ã€`prompt()` å’Œ `confirm()`ï¼‰ç§»è‡³ [**å¯¹è¯æ¡†**](/apis/dialog.md)

### è¿ç§»æ‚¨çš„åº”ç”¨ä»¥ä½¿ç”¨æ–°çš„å®˜æ–¹æ’ä»¶åŒ…

æ­¤å˜æ›´è¦æ±‚æ‚¨å•ç‹¬å®‰è£…æ‚¨æ­£åœ¨ä½¿ç”¨çš„æ¯ä¸ªæ’ä»¶ã€‚

1. åœ¨æ‚¨çš„é¡¹ç›®ä¸­æœç´¢ä» `@capacitor/core` çš„ `Plugins` å¯¹è±¡ä¸­æå–çš„æ ¸å¿ƒæ’ä»¶
1. æŸ¥æ‰¾ç›¸åº”çš„[æ’ä»¶æ–‡æ¡£](/plugins/official.md)ï¼Œæ³¨æ„[æŸäº›æ’ä»¶å·²è¢«æ‹†åˆ†](#æ‹†åˆ†è¾…åŠ©åŠŸèƒ½åº”ç”¨å’Œæ¨¡æ€æ¡†æ’ä»¶)
1. æŒ‰ç…§æ–‡æ¡£ä¸­æ¯ä¸ªæ’ä»¶çš„å®‰è£…è¯´æ˜è¿›è¡Œæ“ä½œ
1. å°†æ’ä»¶å¯¼å…¥æ›´æ”¹ä¸ºä»æ’ä»¶çš„åŒ…ä¸­å¯¼å…¥ï¼ˆå‚è§[æ’ä»¶å¯¼å…¥](#æ’ä»¶å¯¼å…¥)ï¼‰
1. éµå¾ª[å‘åä¸å…¼å®¹çš„æ’ä»¶å˜æ›´](#å‘åä¸å…¼å®¹çš„æ’ä»¶å˜æ›´)ä¸­çš„ä»»ä½•è¯´æ˜

**ä½¿ç”¨ Ionic Frameworkï¼Ÿ**

Ionic Framework ä½¿ç”¨äº†ä»¥ä¸‹æ’ä»¶ä¸­çš„ APIï¼š

- [**åº”ç”¨**](/apis/app.md)
- [**è§¦è§‰åé¦ˆ**](/apis/haptics.md)
- [**é”®ç›˜**](/apis/keyboard.md)
- [**çŠ¶æ€æ **](/apis/status-bar.md)

ä¸ºäº†è·å¾—ä¸ Ionic Framework çš„æœ€ä½³ç”¨æˆ·ä½“éªŒï¼Œæ‚¨åº”ç¡®ä¿å®‰è£…äº†è¿™äº›æ’ä»¶ï¼Œå³ä½¿æ‚¨æ²¡æœ‰åœ¨åº”ç”¨ä¸­å¯¼å…¥å®ƒä»¬ï¼š

```bash
npm install @capacitor/app @capacitor/haptics @capacitor/keyboard @capacitor/status-bar
```

## æ’ä»¶å¯¼å…¥

`Plugins` å¯¹è±¡å·²è¢«å¼ƒç”¨ï¼Œä½†åœ¨ Capacitor 3 ä¸­å°†ç»§ç»­å·¥ä½œã€‚Capacitor æ’ä»¶åº”æ›´æ–°ä»¥ä½¿ç”¨æ–°çš„æ’ä»¶æ³¨å†Œ APIï¼ˆå‚è§[æ’ä»¶å‡çº§æŒ‡å—](/main/updating/plugins/3-0.md)ï¼‰ï¼Œè¿™å°†å…è®¸å®ƒä»¬ç›´æ¥ä»æ’ä»¶çš„åŒ…ä¸­å¯¼å…¥ã€‚

ä»Šåï¼Œä¸åº”å†ä½¿ç”¨æ¥è‡ª `@capacitor/core` çš„ `Plugins` å¯¹è±¡ã€‚

```typescript
// æ—§æ–¹å¼
import { Plugins } from '@capacitor/core';
const { AnyPlugin } = Plugins;
```

é¦–é€‰ç›´æ¥ä»æ’ä»¶çš„åŒ…ä¸­å¯¼å…¥æ’ä»¶ï¼Œä½†æ’ä»¶å¿…é¡»æ›´æ–°ä»¥ä¸ Capacitor 3 å…¼å®¹æ‰èƒ½å®ç°è¿™ä¸€ç‚¹ã€‚

```typescript
// æ–°æ–¹å¼
import { AnyPlugin } from 'any-plugin';
```

## å‘åä¸å…¼å®¹çš„æ’ä»¶å˜æ›´

è™½ç„¶è®¸å¤šæ’ä»¶ API ä¿æŒä¸å˜ä»¥ç®€åŒ–è¿ç§»è‡³ Capacitor 3 çš„è¿‡ç¨‹ï¼Œä½†ä¸€äº› API éœ€è¦ä»£ç æ›´æ–°å’Œæ‰‹åŠ¨è¿ç§»ã€‚

- **è¾…åŠ©åŠŸèƒ½** / **å±å¹•é˜…è¯»å™¨**
  - `isScreenReaderEnabled()` æ–¹æ³•å·²é‡å‘½åä¸º `isEnabled()`
  - `'accessibilityScreenReaderStateChange'` äº‹ä»¶å·²é‡å‘½åä¸º `'stateChange'`
  - åœ¨ Android å’Œ iOS ä¸Šï¼Œ`speak()` ä»…åœ¨å±å¹•é˜…è¯»å™¨å½“å‰æ¿€æ´»æ—¶æœ‰æ•ˆã€‚å¯¹äºå±å¹•é˜…è¯»å™¨æ¿€æ´»æˆ–æœªæ¿€æ´»æ—¶çš„æ–‡æœ¬è½¬è¯­éŸ³åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ [`@capacitor-community/text-to-speech`](https://github.com/capacitor-community/text-to-speech)ã€‚
- **æµè§ˆå™¨**
  - `prefetch()` å·²è¢«ç§»é™¤ã€‚
- **è®¾å¤‡**
  - åº”ç”¨ä¿¡æ¯å·²ä» `getInfo()` ä¸­ç§»é™¤ï¼ˆ`appVersion`ã€`appBuild`ã€`appId` å’Œ `appName`ï¼‰ã€‚è¯·ä½¿ç”¨åº”ç”¨æ’ä»¶çš„ [`getInfo()`](/apis/app.md#getinfo) è·å–æ­¤ä¿¡æ¯ã€‚
  - `uuid` å·²ä» `getInfo()` ä¸­ç§»é™¤ã€‚è¯·ä½¿ç”¨æ–°çš„ `getId()` å‡½æ•°ã€‚
- **è§¦è§‰åé¦ˆ**
  - `HapticsNotificationType` æšä¸¾é”®å·²ä»å¤§å†™è½¬æ¢ä¸ºé©¼å³°å¼ä»¥åŒ¹é…å…¶ä»–æšä¸¾ã€‚
- **æœ¬åœ°é€šçŸ¥**
  - æ­¤æ’ä»¶ç°åœ¨ä½¿ç”¨æ–°çš„æƒé™ APIã€‚`requestPermission()` å·²è¢«ç§»é™¤ï¼Œè¯·ä½¿ç”¨ `requestPermissions()`ã€‚
- **æ¨é€é€šçŸ¥**
  - æ­¤æ’ä»¶ç°åœ¨ä½¿ç”¨æ–°çš„æƒé™ APIã€‚`requestPermission()` å·²è¢«ç§»é™¤ï¼Œè¯·ä½¿ç”¨ `requestPermissions()`ã€‚
- **åˆ†äº«**
  - `share()` æ–¹æ³•ç°åœ¨è¿”å› `ShareResult` è€Œä¸æ˜¯ `any`
  - `share()` çš„è¿”å›å€¼å°†ä¸å†åŒ…å« `completed`ã€‚å¦‚æœæœªå®Œæˆï¼Œå®ƒå°†æ”¹ä¸ºæ‹’ç»ã€‚
- **å­˜å‚¨**
  - **éœ€è¦æ•°æ®è¿ç§»ï¼** å†…éƒ¨å­˜å‚¨æœºåˆ¶å·²æ›´æ”¹ï¼Œéœ€è¦æ•°æ®è¿ç§»ã€‚å·²æ·»åŠ ä¸€ä¸ªä¾¿æ·æ–¹æ³•ï¼š`migrate()`ã€‚è¦åœ¨ä¸å½±å“æœ€ç»ˆç”¨æˆ·çš„æƒ…å†µä¸‹æ›´æ–°æ‚¨çš„åº”ç”¨ï¼Œè¯·åœ¨è°ƒç”¨ä»»ä½•å…¶ä»–æ–¹æ³•ä¹‹å‰è°ƒç”¨ `migrate()`ã€‚
- **æ–‡ä»¶ç³»ç»Ÿ**
  - `stat()` æ–¹æ³•ç°åœ¨åœ¨æ‰€æœ‰å¹³å°ä¸Šä»¥æ¯«ç§’ä¸ºå•ä½è¿”å› ctime å’Œ mtime æ—¶é—´æˆ³ã€‚ä»¥å‰ï¼ŒiOS è¿”å›çš„æ—¶é—´æˆ³ä»¥ç§’ä¸ºå•ä½ã€‚

## æ—¥å¿—è®°å½•å˜æ›´

Capacitor 3 ä¸­å·²å¼ƒç”¨ `hideLogs` é…ç½®é€‰é¡¹ã€‚å®ƒå·²è¢«æ–°çš„ `loggingBehavior` é…ç½®é€‰é¡¹æ›¿ä»£ã€‚è¯¦æƒ…å¯åœ¨[é…ç½®æ–‡æ¡£](/main/reference/config.md)ä¸­æ‰¾åˆ°ã€‚

## iOS

Capacitor 3 æ”¯æŒ iOS 12+ã€‚éœ€è¦ Xcode 12+ã€‚æ¨èä½¿ç”¨ CocoaPods 1.8+ã€‚

### æ›´æ–° CocoaPods

å»ºè®®å°† CocoaPods å‡çº§è‡³æœ€æ–°ç¨³å®šç‰ˆæœ¬ã€‚[CocoaPods 1.8](https://blog.cocoapods.org/CocoaPods-1.8.0-beta/) æ”¹ä¸ºä½¿ç”¨ CDNï¼Œè¿™æ„å‘³ç€ä¸å†éœ€è¦å®šæœŸè¿è¡Œ `pod repo update`ã€‚

ä½¿ç”¨ `pod --version` æ£€æŸ¥æ‚¨çš„ CocoaPods ç‰ˆæœ¬ï¼Œå¹¶è®¿é—® [cocoapods.org](https://cocoapods.org) è·å–å®‰è£…è¯´æ˜ã€‚

### å°† iOS éƒ¨ç½²ç›®æ ‡è®¾ç½®ä¸º 12.0

ä¸ºæ‚¨çš„ Xcode é¡¹ç›®å’Œåº”ç”¨ç¨‹åºç›®æ ‡æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šæ‰“å¼€ **Build Settings** æ ‡ç­¾é¡µã€‚åœ¨ **Deployment** éƒ¨åˆ†ä¸‹ï¼Œå°† **iOS Deployment Target** æ›´æ”¹ä¸º **iOS 12.0**ã€‚

ç„¶åï¼Œæ‰“å¼€ `ios/App/Podfile` å¹¶å°† iOS ç‰ˆæœ¬æ›´æ–°ä¸º 12.0ï¼š

```diff
-platform :ios, '11.0'
+platform :ios, '12.0'
 use_frameworks!
```

### å°† Swift ç‰ˆæœ¬è®¾ç½®ä¸º 5

å¦‚æœæ‚¨çš„åº”ç”¨å°šæœªä½¿ç”¨ Swift 5ï¼Œè¯·åœ¨ Xcode ç›®æ ‡ä¸­æ‰“å¼€ **Build Settings** æ ‡ç­¾é¡µï¼Œç„¶ååœ¨ **Swift Compiler - Language** éƒ¨åˆ†ä¸‹å°† **Swift Language Version** æ›´æ”¹ä¸º **Swift 5**ã€‚

### å°† `public` ç§»è‡³ iOS ç›®æ ‡ç›®å½•

åœ¨ Capacitor 3 ä¸­ï¼Œå»ºè®®å°† `ios/App/public` ç›®å½•ç§»è‡³ `ios/App/App/public`ã€‚è¿™å¯ä»¥åœ¨ Xcode ä¸­å®ç°ï¼š

**ç§»é™¤ç°æœ‰çš„ `public` æ–‡ä»¶å¤¹**

1. å±•å¼€ `App` é¡¹ç›®ä¸‹çš„æ–‡ä»¶æ ‘ï¼Œç„¶åé€‰æ‹© `App` ç»„ï¼Œå†é€‰æ‹© `public` æ–‡ä»¶å¤¹ã€‚
1. å³é”®å•å‡» **Delete**ã€‚å½“æç¤ºåˆ é™¤æ–‡ä»¶å¤¹æˆ–ä»…ç§»é™¤å¼•ç”¨æ—¶ï¼Œé€‰æ‹© **Move to Trash**ã€‚

![åˆ é™¤ public æ–‡ä»¶å¤¹](../../../../static/img/v5/docs/ios/xcode-public-delete-folder.png)

**åœ¨æ–°ä½ç½®é‡æ–°åˆ›å»º `public`**

1. å³é”®å•å‡» `App` é¡¹ç›®å†…çš„ `App` ç»„ï¼Œç„¶åå•å‡» **Add Files to "App"...**
1. ä¿ç•™é»˜è®¤é€‰é¡¹ï¼ˆç¡®ä¿åˆ›å»ºæ–‡ä»¶å¤¹å¼•ç”¨ï¼Œè€Œéç»„ï¼Œå¹¶æ·»åŠ åˆ° `App` ç›®æ ‡ï¼‰ã€‚
1. å•å‡» **New Folder**ï¼Œå‘½åä¸º "public"ã€‚
1. å•å‡» **Create**ï¼Œç„¶åå•å‡» **Add**ã€‚

![é‡æ–°åˆ›å»º public æ–‡ä»¶å¤¹](../../../../static/img/v5/docs/ios/xcode-public-new-folder.png)

åœ¨ Xcode ä¸­å¯èƒ½çœ‹èµ·æ¥ç›¸åŒï¼Œä½†æ–°çš„ `public` æ–‡ä»¶å¤¹ç°åœ¨åº”ç›¸å¯¹äº `App` ç»„ï¼Œè€Œéé¡¹ç›®æ ¹ç›®å½•ã€‚

**gitignore æ–°çš„ `public` æ–‡ä»¶å¤¹**

åœ¨ `ios/.gitignore` ä¸­ï¼Œå°†å¿½ç•¥è·¯å¾„ä» `App/public` æ›´æ”¹ä¸º `App/App/public`ã€‚æ­¤æ–‡ä»¶å¤¹åŒ…å«æ‚¨çš„ Web èµ„æºå‰¯æœ¬ï¼Œä¸åº”æäº¤ã€‚

```diff
 App/build
 App/Pods
-App/public
+App/App/public
 App/Podfile.lock
 xcuserdata
```

### æ›´æ–° Capacitor iOS å¹³å°

```bash
npm install @capacitor/ios@latest-3
npx cap sync ios
```

### åœ¨åº”ç”¨ç¨‹åºäº‹ä»¶ä¸­ä» `CAPBridge` åˆ‡æ¢åˆ° `ApplicationDelegateProxy`

åœ¨ `ios/App/App/AppDelegate.swift` ä¸­ï¼Œæ›´æ–°ä»¥ä¸‹å†…å®¹ï¼š

```diff
     func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:]) -> Bool {
         // Called when the app was launched with a url. Feel free to add additional processing here,
         // but if you want the App API to support tracking app url opens, make sure to keep this call
-        return CAPBridge.handleOpenUrl(url, options)
+        return ApplicationDelegateProxy.shared.application(app, open: url, options: options)
     }

     func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
         // Called when the app was launched with an activity, including Universal Links.
         // Feel free to add additional processing here, but if you want the App API to support
         // tracking app url opens, make sure to keep this call
-        return CAPBridge.handleContinueActivity(userActivity, restorationHandler)
+        return ApplicationDelegateProxy.shared.application(application, continue: userActivity, restorationHandler: restorationHandler)
     }
```

### ç§»é™¤ USE_PUSH ç¼–è¯‘æ¡ä»¶

å¦‚æœä½¿ç”¨æ¨é€é€šçŸ¥åŠŸèƒ½ï¼Œåœ¨ `ios/App/App/AppDelegate.swift` ä¸­æ›´æ–°ä»¥ä¸‹å†…å®¹ï¼š

```diff

-    #if USE_PUSH

     func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
        NotificationCenter.default.post(name: Notification.Name(CAPNotifications.DidRegisterForRemoteNotificationsWithDeviceToken.name()), object: deviceToken)
     }

     func application(_ application: UIApplication, didFailToRegisterForRemoteNotificationsWithError error: Error) {
        NotificationCenter.default.post(name: Notification.Name(CAPNotifications.DidFailToRegisterForRemoteNotificationsWithError.name()), object: error)
     }

-#endif
```

å¦‚æœä¸ä½¿ç”¨æ¨é€é€šçŸ¥ï¼Œæ‚¨å¯ä»¥ç§»é™¤æ•´ä¸ªä»£ç å—

```diff
-    #if USE_PUSH
-
-    func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
-        NotificationCenter.default.post(name: Notification.Name(CAPNotifications.DidRegisterForRemoteNotificationsWithDeviceToken.name()), object: deviceToken)
-    }
-
-    func application(_ application: UIApplication, didFailToRegisterForRemoteNotificationsWithError error: Error) {
-        NotificationCenter.default.post(name: Notification.Name(CAPNotifications.DidFailToRegisterForRemoteNotificationsWithError.name()), object: error)
-    }
-
-#endif
```

### ä»ç¡¬ç¼–ç çš„ `CAPNotifications` åˆ‡æ¢åˆ° `NSNotification` æ‰©å±•

åœ¨ `ios/App/App/AppDelegate.swift` ä¸­ï¼Œæ›´æ–°ä»¥ä¸‹å†…å®¹ï¼š

```diff
     override func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {
         super.touchesBegan(touches, with: event)

         let statusBarRect = UIApplication.shared.statusBarFrame
         guard let touchPoint = event?.allTouches?.first?.location(in: self.window) else { return }

         if statusBarRect.contains(touchPoint) {
-            NotificationCenter.default.post(CAPBridge.statusBarTappedNotification)
+            NotificationCenter.default.post(name: .capacitorStatusBarTapped, object: nil)
         }
     }

     func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
-        NotificationCenter.default.post(name: Notification.Name(CAPNotifications.DidRegisterForRemoteNotificationsWithDeviceToken.name()), object: deviceToken)
+        NotificationCenter.default.post(name: .capacitorDidRegisterForRemoteNotifications, object: deviceToken)
     }

     func application(_ application: UIApplication, didFailToRegisterForRemoteNotificationsWithError error: Error) {
-        NotificationCenter.default.post(name: Notification.Name(CAPNotifications.DidFailToRegisterForRemoteNotificationsWithError.name()), object: error)
+        NotificationCenter.default.post(name: .capacitorDidFailToRegisterForRemoteNotifications, object: error)
     }
```

### å¿½ç•¥ `DerivedData`

å°† `DerivedData` æ·»åŠ åˆ° `ios/.gitignore` æ–‡ä»¶ä¸­ã€‚è¿™æ˜¯ Capacitor CLI æ”¾ç½®æœ¬åœ° iOS æ„å»ºçš„ä½ç½®ã€‚

```diff
 App/Pods
 App/App/public
 App/Podfile.lock
+DerivedData
 xcuserdata

 # Cordova plugins for Capacitor
```

## Android

Capacitor 3 æ”¯æŒ Android 5+ï¼ˆå¹¶ä¸”ç°åœ¨æ”¯æŒ Android 11ï¼‰ã€‚éœ€è¦ Android Studio 4+ã€‚

### æ›´æ–° Capacitor Android å¹³å°

```bash
npm install @capacitor/android@latest-3
npx cap sync android
```

### åˆ‡æ¢åˆ°è‡ªåŠ¨åŠ è½½ Android æ’ä»¶

åœ¨ Capacitor 3 ä¸­ï¼Œé¦–é€‰è‡ªåŠ¨åŠ è½½ Android æ’ä»¶ã€‚åœ¨ `MainActivity.java` ä¸­ï¼Œå¯ä»¥ç§»é™¤ `onCreate` æ–¹æ³•ã€‚æ·»åŠ æˆ–ç§»é™¤é€šè¿‡ npm å®‰è£…çš„æ’ä»¶æ—¶ï¼Œæ‚¨ä¸å†éœ€è¦ç¼–è¾‘æ­¤æ–‡ä»¶ã€‚

```diff
 public class MainActivity extends BridgeActivity {
-    @Override
-    public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-
-        // Initializes the Bridge
-        this.init(savedInstanceState, new ArrayList<Class<? extends Plugin>>() {{
-            // Additional plugins you've installed go here
-            add(Plugin1.class);
-            add(Plugin2.class);
-        }});
-    }
 }
```

å¦‚æœæ‚¨çš„åº”ç”¨åŒ…å«ä¸“é—¨ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ„å»ºçš„è‡ªå®šä¹‰æ’ä»¶ï¼Œæ‚¨ä»ç„¶éœ€è¦åœ¨ `onCreate` ä¸­æ³¨å†Œè¿™äº›æ’ä»¶ï¼š

```diff
 public class MainActivity extends BridgeActivity {
     @Override
     public void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);

+        registerPlugin(PluginInMyApp.class);
     }
 }
```

### æ›´æ–° Gradle è‡³ 7.0

æˆ‘ä»¬ç°åœ¨æ¨èåœ¨ Capacitor é¡¹ç›®ä¸­ä½¿ç”¨ Gradle 7.0ã€‚åœ¨ Android Studio ä¸­ï¼Œæ‰“å¼€ **File** èœå•ï¼Œç„¶åå•å‡» **Project Structure**ã€‚åœ¨ **Project** éƒ¨åˆ†ï¼Œå°† **Gradle Version** æ›´æ”¹ä¸º **7.0**ï¼Œå°† **Android Gradle Plugin Version** æ›´æ”¹ä¸º **4.2.0**ã€‚ç„¶åï¼Œå•å‡» **OK**ã€‚

æ‚¨å¯èƒ½å¸Œæœ›è¯„ä¼° **Project Structure** å¯¹è¯æ¡†çš„ **Suggestions** éƒ¨åˆ†ä¸­å»ºè®®çš„ Android åŒ…æ›´æ–°ã€‚

### æ›´æ–° Android å˜é‡

åœ¨ `android/variables.gradle` ä¸­ï¼Œæ‚¨å¯ä»¥æ›´æ–°ä»¥ä¸‹å˜é‡ï¼š

```diff
 ext {
     minSdkVersion = 21
-    compileSdkVersion = 29
-    targetSdkVersion = 29
+    compileSdkVersion = 30
+    targetSdkVersion = 30
+    androidxActivityVersion = '1.2.0'
-    androidxAppCompatVersion = '1.1.0'
+    androidxAppCompatVersion = '1.2.0'
+    androidxCoordinatorLayoutVersion = '1.1.0'
-    androidxCoreVersion =  '1.2.0'
-    androidxMaterialVersion =  '1.1.0-rc02'
-    androidxBrowserVersion =  '1.2.0'
-    androidxLocalbroadcastmanagerVersion =  '1.0.0'
-    androidxExifInterfaceVersion = '1.2.0'
-    firebaseMessagingVersion =  '20.1.2'
-    playServicesLocationVersion =  '17.0.0'
+    androidxCoreVersion = '1.3.2'
+    androidxFragmentVersion = '1.3.0'
-    junitVersion =  '4.12'
-    androidxJunitVersion =  '1.1.1'
-    androidxEspressoCoreVersion =  '3.2.0'
+    junitVersion = '4.13.1'
+    androidxJunitVersion = '1.1.2'
+    androidxEspressoCoreVersion = '3.3.0'
     cordovaAndroidVersion = '7.0.0'
 }
```

Capacitor 3 æ”¯æŒ Android 11ï¼ˆAPI 30ï¼‰ï¼Œå› æ­¤æ‚¨å¯ä»¥å°† SDK ç›®æ ‡æ›´æ–°ä¸º 30ã€‚å°† `compileSdkVersion` å’Œ `targetSdkVersion` æ›´æ”¹ä¸º `30`ã€‚

æ–°çš„ `androidxActivityVersion` å˜é‡å¯ç”¨ï¼Œæ·»åŠ å®ƒå¹¶è®¾ç½®å€¼ä¸º `1.2.0`ã€‚

`androidxAppCompatVersion` å¯ä»¥æ›´æ–°ä¸º `1.2.0`ã€‚

æ–°çš„ `androidxCoordinatorLayoutVersion` å˜é‡å¯ç”¨ï¼Œæ·»åŠ å®ƒå¹¶è®¾ç½®å€¼ä¸º `1.1.0`ã€‚

`androidxCoreVersion` å¯ä»¥æ›´æ–°ä¸º `1.3.2`ã€‚

`androidxMaterialVersion` å˜é‡ç”±æ“ä½œè¡¨å’Œç›¸æœºæ’ä»¶ä½¿ç”¨ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™äº›æ’ä»¶ï¼Œå¯ä»¥ç§»é™¤ã€‚å¦‚æœä½¿ç”¨ï¼Œè¯·æ£€æŸ¥[ç›¸æœºæ–‡æ¡£](https://capacitorjs.com/docs/v3/apis/camera#variables)å’Œ[æ“ä½œè¡¨æ–‡æ¡£](https://capacitorjs.com/docs/v3/apis/action-sheet#variables)ã€‚

`androidxBrowserVersion` å˜é‡ç”±æµè§ˆå™¨æ’ä»¶ä½¿ç”¨ï¼Œå¦‚æœä¸ä½¿ç”¨è¯¥æ’ä»¶ï¼Œå¯ä»¥ç§»é™¤ã€‚å¦‚æœä½¿ç”¨è¯¥æ’ä»¶ï¼Œè¯·æ£€æŸ¥[æ–‡æ¡£](https://capacitorjs.com/docs/v3/apis/browser#variables)ã€‚

`androidxLocalbroadcastmanagerVersion` å˜é‡å¯ä»¥ç§»é™¤ã€‚

`androidxExifInterfaceVersion` å˜é‡ç”±ç›¸æœºæ’ä»¶ä½¿ç”¨ï¼Œå¦‚æœä¸ä½¿ç”¨è¯¥æ’ä»¶ï¼Œå¯ä»¥ç§»é™¤ã€‚å¦‚æœä½¿ç”¨è¯¥æ’ä»¶ï¼Œè¯·æ£€æŸ¥[æ–‡æ¡£](https://capacitorjs.com/docs/v3/apis/camera#variables)ã€‚

`firebaseMessagingVersion` å˜é‡ç”±æ¨é€é€šçŸ¥æ’ä»¶ä½¿ç”¨ï¼Œå¦‚æœä¸ä½¿ç”¨è¯¥æ’ä»¶ï¼Œå¯ä»¥ç§»é™¤ã€‚å¦‚æœä½¿ç”¨è¯¥æ’ä»¶ï¼Œè¯·æ£€æŸ¥[æ–‡æ¡£](https://capacitorjs.com/docs/v3/apis/push-notifications#variables)ã€‚

`playServicesLocationVersion` å˜é‡ç”±åœ°ç†ä½ç½®æ’ä»¶ä½¿ç”¨ï¼Œå¦‚æœä¸ä½¿ç”¨è¯¥æ’ä»¶ï¼Œå¯ä»¥ç§»é™¤ã€‚å¦‚æœä½¿ç”¨è¯¥æ’ä»¶ï¼Œè¯·æ£€æŸ¥[æ–‡æ¡£](https://capacitorjs.com/docs/v3/apis/geolocation#variables)ã€‚

æ–°çš„ `androidxFragmentVersion` å˜é‡å¯ç”¨ï¼Œæ·»åŠ å®ƒå¹¶è®¾ç½®å€¼ä¸º `1.3.0`ã€‚

`junitVersion` å¯ä»¥æ›´æ–°ä¸º `4.13.1`ã€‚

`androidxJunitVersion` å¯ä»¥æ›´æ–°ä¸º `1.1.2`ã€‚

`androidxEspressoCoreVersion` å¯ä»¥æ›´æ–°ä¸º `3.3.0`ã€‚

### ç§»é™¤æœªä½¿ç”¨å’Œå†—ä½™çš„æƒé™

æ ¹æ®æ‚¨ä½¿ç”¨çš„æ’ä»¶ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä»åº”ç”¨çš„ `AndroidManifest.xml` æ–‡ä»¶ä¸­ç§»é™¤æœªä½¿ç”¨çš„æƒé™ã€‚[æ–° Capacitor åº”ç”¨ä¸­çš„æ¸…å•](https://github.com/ionic-team/capacitor/blob/5.x/android-template/app/src/main/AndroidManifest.xml)ä»…åŒ…å« `INTERNET`ï¼Œå› ä¸ºæƒé™ç°åœ¨åº”åœ¨å®‰è£…æ’ä»¶æ—¶æ·»åŠ ã€‚æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ç§»é™¤æœªä½¿ç”¨çš„æƒé™ï¼š

1. ç¡®å®šæ‚¨çš„åº”ç”¨ä½¿ç”¨çš„æ’ä»¶
1. é˜…è¯»æ¯ä¸ªæ’ä»¶[åœ¨è¿™äº›æ–‡æ¡£ä¸­](/plugins/official.md)çš„å®‰è£…è¯´æ˜ï¼ŒæŸ¥æ‰¾æ¯ä¸ªæ’ä»¶æ‰€éœ€çš„æƒé™
1. åœ¨åº”ç”¨çš„ `AndroidManifest.xml` æ–‡ä»¶ä¸­ï¼Œä¿ç•™æ‚¨çš„æ’ä»¶æ‰€éœ€çš„æƒé™ï¼Œç§»é™¤æœªä½¿ç”¨çš„æƒé™

è§¦è§‰åé¦ˆå’Œç½‘ç»œæ’ä»¶æ˜¯ç°åœ¨åœ¨å…¶è‡ªå·±çš„ `AndroidManifest.xml` æ–‡ä»¶ä¸­åŒ…å«å®‰è£…æ—¶æƒé™çš„ç¤ºä¾‹ï¼Œè¿™äº›æ–‡ä»¶æœ€ç»ˆä¼š[ä¸æ‚¨çš„åº”ç”¨çš„æ¸…å•åˆå¹¶](https://developer.android.com/studio/build/manifest-merge)ã€‚ä»æ‚¨çš„åº”ç”¨çš„ `AndroidManifest.xml` æ–‡ä»¶ä¸­ç§»é™¤å®ƒä»¬çš„æƒé™æ˜¯å®‰å…¨çš„ï¼š

```diff
     <!-- Permissions -->

     <uses-permission android:name="android.permission.INTERNET" />

-    <!-- Network API -->
-    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

-    <!-- Vibration API -->
-    <uses-permission android:name="android.permission.VIBRATE" />

 </manifest>
```
